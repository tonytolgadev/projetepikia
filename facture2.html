<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Document</title>
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.3/css/bootstrap.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
<link rel="stylesheet" href="css/facture2.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.js"></script>
</head>

<body>

    <input type="checkbox" id="sidebar-toggle">
    <div class="sidebar">
        <div class="sidebar-header">
            <h3 class="brand">
                <span class="ti-unlink"></span>
                <span>Epikia</span>
            </h3>
            <label for="sidebar-toggle" class="ti-menu-alt"></label>
        </div>

        <div class="sidebar-menu">
            <ul>
                <li>
                    <a href="dashboard.html">
                        <span class="ti-home"></span>
                        <span>Accueil</span>
                    </a>
                </li>
                <li>
                    <a href="">
                        <span class="ti-face-smile"></span>
                        <span>Profil Pro</span>
                    </a>
                </li>
                <li>
                    <a href="facture2.html">
                        <span class="ti-agenda"></span>
                        <span>Facture</span>
                    </a>
                </li>
                <li>
                    <a href="abonnement.html">
                        <span class="ti-clipboard"></span>
                        <span>Abonnement</span>
                    </a>
                </li>

            </ul>
        </div>
    </div>

    
    <div class="main-content">



            <div class="client">

                <h2>Client</h2>
                <input type="text" nom="nom" placeholder="Nom"> 
                <input type="text" nom="prenom" placeholder="Prénom"> <br>
                <input type="text" nom="adresse" placeholder="N° et Rue">
                <input type="text" nom="adresse" placeholder="Ville"><br>
                <input type="text" nom="mail" placeholder="Mail"> 
                <input type="text" nom="tel" placeholder="Téléphone">
        
        
        
            </div>
            <div id="app">
                <item-modal v-if="current" :item="current" :close="close" :save="save" :index="index" :remove="remove">
                </item-modal>
                <div class="row">
                    <div class="col-4"></div>
                    <div class="col-4">
                        <table class="table table-striped">
                            
                            <!-- <thead>
                                <tr>
                                    <th>Désignation des éléments</th>
                                    <th>Quantité</th>
                                </tr>
                            </thead> -->
                            <tbody>
                                <tr v-for="(item, index) in items" class="element-line" @click="modify(index)">
                                    <td>
                                        <span v-if="item.colorPages > 0">{{item.colorPages}} Pages couleurs
                                            {{item.size}}<br></span>
                                        <span v-if="item.bwPages > 0">{{item.bwPages}} Pages noir et blanc
                                            {{item.size}}<br></span>
                                        <span v-if="item.reliure">Reliure {{getReliure(item) | reliureRead}}<br></span>
                                    </td>
                                    <td>
                                        {{item.quantity}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <hr>
                <div class="centered">
                    <button type="button" class="btn btn-primary btn-ajouter" @click="add">Ajouter une facture</button>
                </div>
                <hr>
                <br><br>
        
                <!-- <div class="form-group centered etudiant" :class="{selected: student}">
                    <div class="form-check form-check-inline">
                        <label class="form-check-label">
                            <input class="form-check-input" type="checkbox" v-model="student"> Tarif étudiant
                        </label>
                    </div>
                </div> -->
        
                <br>
                <h2>Facture</h2>
                <br>
                <table class="table table-striped facture">
                    <thead>
                        <tr>
                            <th class="left">Désignation des éléments</th>
                            <th>Quantité</th>
                            <th>Prix unitaire</th>
                            <th>Prix</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="colorA4Qty > 0">
                            <td class="left">Pages couleurs A4</td>
                            <td>{{colorA4Qty}}</td>
                            <td>{{colorA4UnitPrice | price}} &euro;</td>
                            <td>{{colorA4Qty * colorA4UnitPrice | price}} &euro;</td>
                        </tr>
                        <tr v-if="bwA4Qty > 0">
                            <td class="left">Pages noir et blanc A4</td>
                            <td>{{bwA4Qty}}</td>
                            <td>{{bwA4UnitPrice | price}} &euro;</td>
                            <td>{{bwA4Qty * bwA4UnitPrice | price}} &euro;</td>
                        </tr>
                        <tr v-if="colorA3Qty > 0">
                            <td class="left">Pages couleurs A3</td>
                            <td>{{colorA3Qty}}</td>
                            <td>{{colorA3UnitPrice | price}} &euro;</td>
                            <td>{{colorA3Qty * colorA3UnitPrice | price}} &euro;</td>
                        </tr>
                        <tr v-if="bwA3Qty > 0">
                            <td class="left">Pages noir et blanc A3</td>
                            <td>{{bwA3Qty}}</td>
                            <td>{{bwA3UnitPrice | price}} &euro;</td>
                            <td>{{bwA3Qty * bwA3UnitPrice | price}} &euro;</td>
                        </tr>
                        <tr v-for="(qty, reliure) in reliureList">
                            <td class="left">Reliure {{reliure | reliureRead}}</td>
                            <td>{{qty}}</td>
                            <td>{{reliureUnitPrice(reliure) | price}} &euro;</td>
                            <td>{{qty * reliureUnitPrice(reliure) | price}} &euro;</td>
                        </tr>
                        <tr v-if="student">
                            <th colspan="3">Sous-total</th>
                            <td>{{subTotal | price}} &euro;</td>
                        </tr>
                        <!-- <tr v-if="student">
                            <th colspan="3">Réduction étudiant -20%</th>
                            <td>-{{subTotal * 0.2 | price}} &euro;</td>
                        </tr> -->
                        <tr>
                            <th colspan="3">Total</th>
                            <td>{{total | price}} &euro;</td>
                        </tr>
                    </tbody>
                </table>
        
            </div>
     

            

    

    </div>

</body>
<script>

    Vue.component('item-modal', {
        props: ['item', 'close', 'save', 'index', 'remove'],
        watch: {
            'item.size': function (value) {
                if (value === 'A3') {
                    this.item.reliure = '';
                }
            }
        },
        template: `
      <div class="modal fade">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">{{index === -1 ? 'Ajouter' : 'Modifier'}}</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close" @click="close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
  
              <div class="form-group row">
                <label for="quantity" class="col-6 col-form-label">Nombre d'exemplaires</label>
                <div class="col-6">
                  <input class="form-control" type="number" v-model="item.quantity" id="quantity">
                </div>
              </div>
  
              <div class="form-group row"><div class="col-6">Pour chaque exemplaire :</div></div>
  
              <div class="form-group row">
                <label for="colorPages" class="col-6 col-form-label">Pages Couleur</label>
                <div class="col-6">
                  <input class="form-control" type="number" v-model="item.colorPages" id="colorPages">
                </div>
              </div>
  
              <div class="form-group row">
                <label for="bwPages" class="col-6 col-form-label">Pages Noir et Blanc</label>
                <div class="col-6">
                  <input class="form-control" type="number" v-model="item.bwPages" id="bwPages">
                </div>
              </div>
  
              <div class="form-group">
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="A4" v-model="item.size"> A4
                  </label>
                </div>
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="A3" v-model="item.size"> A3
                  </label>
                </div>
              </div>
  
              <div class="form-group">
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="" v-model="item.reliure"> Aucune
                  </label>
                </div>
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="spiral" v-model="item.reliure" :disabled="item.size === 'A3'"> Spirales plastiques
                  </label>
                </div>
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="doscarre" v-model="item.reliure" :disabled="item.size === 'A3'"> Dos carré collé
                  </label>
                </div>
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="baguette" v-model="item.reliure" :disabled="item.size === 'A3'"> Baguette
                  </label>
                </div>
                <div class="form-check form-check-inline">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" value="thermocolle" v-model="item.reliure" :disabled="item.size === 'A3'"> Thermocollée
                  </label>
                </div>
              </div>
  
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" @click="save">{{ index === -1 ? 'Ajouter' : 'Modifier'}}</button>
  <button type="button" class="btn btn-danger" @click="remove" v-if="index >= 0">Supprimer</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal" @click="close">Annuler</button>
            </div>
          </div>
        </div>
      </div>
    `
    });

    new Vue({
        el: '#app',
        data: {
            items: [],
            current: null,
            index: -1,
            student: false
        },
        filters: {
            price(value) {
                return value.toFixed(2);
            },
            reliureRead(reliure) {
                switch (reliure) {
                    case 'spiralS':
                        return "spirales plastiques S";
                    case 'spiralM':
                        return "spirales plastiques M";
                    case 'spiralL':
                        return "spirales plastiques L";
                    case 'doscarre':
                        return "dos carré collée";
                    case 'baguette':
                        return "baguette";
                    case 'thermocolle':
                        return "thermocollée";
                }
            },
        },
        computed: {
            colorA4Qty() {
                return this.items.reduce((acc, i) => acc + (i.size === 'A4' ? parseInt(i.colorPages, 10) * parseInt(i.quantity, 10) : 0), 0);
            },
            colorA4UnitPrice() {
                let qty = this.colorA4Qty;
                return qty < 51 ? 0.5 : qty < 101 ? 0.45 : 0.38;
            },
            bwA4Qty() {
                return this.items.reduce((acc, i) => acc + (i.size === 'A4' ? parseInt(i.bwPages, 10) * parseInt(i.quantity, 10) : 0), 0);
            },
            bwA4UnitPrice() {
                let qty = this.bwA4Qty;
                return qty < 11 ? 0.3 : qty < 21 ? 0.25 : qty < 51 ? 0.23 : qty < 101 ? 0.20 : qty < 201 ? 0.18 : 0.10;
            },
            colorA3Qty() {
                return this.items.reduce((acc, i) => acc + (i.size === 'A3' ? parseInt(i.colorPages, 10) * parseInt(i.quantity, 10) : 0), 0);
            },
            colorA3UnitPrice() {
                let qty = this.colorA3Qty;
                return 2 * (qty < 51 ? 0.5 : qty < 101 ? 0.45 : 0.38);
            },
            bwA3Qty() {
                return this.items.reduce((acc, i) => acc + (i.size === 'A3' ? parseInt(i.bwPages, 10) * parseInt(i.quantity, 10) : 0), 0);
            },
            bwA3UnitPrice() {
                let qty = this.bwA3Qty;
                return 2 * (qty < 11 ? 0.3 : qty < 21 ? 0.25 : qty < 51 ? 0.23 : qty < 101 ? 0.20 : qty < 201 ? 0.18 : 0.10);
            },
            reliureList() {
                return this.items.reduce((acc, i) => {
                    let reliure = this.getReliure(i);
                    if (!reliure) { return acc; }
                    if (acc[reliure]) {
                        acc[reliure] += parseInt(i.quantity, 10);
                    } else {
                        acc[reliure] = parseInt(i.quantity, 10);
                    }
                    return acc;
                }, {});
            },
            subTotal() {
                return this.colorA4Qty * this.colorA4UnitPrice +
                    this.bwA4Qty * this.bwA4UnitPrice +
                    this.colorA3Qty * this.colorA3UnitPrice +
                    this.bwA3Qty * this.bwA3UnitPrice +
                    Object.keys(this.reliureList).reduce((acc, r) => acc + (this.reliureUnitPrice(r) * this.reliureList[r]), 0);
            },
            total() {
                return this.student ? this.subTotal * 0.8 : this.subTotal;
            }
        },
        methods: {
            add() {
                this.current = {
                    quantity: 1,
                    colorPages: 0,
                    bwPages: 0,
                    reliure: '',
                    size: 'A4'
                }
                this.index = -1;
            },
            modify(index) {
                this.index = index;
                this.current = Object.assign({}, this.items[index]);
            },
            close() {
                this.current = null;
            },
            save() {
                if (this.index < 0) {
                    this.items.push(this.current);
                } else {
                    this.items[this.index] = Object.assign({}, this.current);
                    this.items.push({});
                    this.items.pop();
                }
                this.current = null;
            },
            remove() {
                if (this.index < 0) { return; }
                this.items.splice(this.index, 1);
                this.current = null;
            },
            getReliure(item) {
                if (item.reliure != 'spiral') {
                    return item.reliure;
                }
                let nbPages = parseInt(item.colorPages, 10) + parseInt(item.bwPages, 10);
                return "spiral" + (nbPages < 50 ? 'S' : (nbPages >= 100 ? 'L' : 'M'));
            },
            reliureUnitPrice(reliure) {
                switch (reliure) {
                    case 'spiralS':
                        return 3.5;
                    case 'spiralM':
                        return 4.5;
                    case 'spiralL':
                        return 8;
                    case 'doscarre':
                        return 14;
                    case 'baguette':
                        return 5;
                    case 'thermocolle':
                        return 8;
                }
            }
        }
    })

</script>

</html>